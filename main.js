(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,n,o,r){var c,a=e.querySelector(".card").cloneNode(!0),s=a.querySelector(".card__likes-quantity"),i=a.querySelector(".card__delete-button"),u=a.querySelector(".card__like-button");return a.querySelector(".card__title").textContent=t.name,a.querySelector(".card__image").src=t.link,a.querySelector(".card__image").alt=t.name,c=t.owner._id,document.querySelector(".profile__info").dataset.userId!==c?(i.disabled=!0,i.classList.add("card__delete-button_inactive")):n(a),o(a),r(a,t.name,t.link),a.dataset.ownerId=t.owner._id,a.dataset.imgId=t._id,s.textContent=t.likes.length,t.likes.some((function(e){return e._id===document.querySelector(".profile__info").dataset.userId}))&&u.classList.add("card__like-button_is-active"),a}function n(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}function o(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function c(e){return e.querySelector(".popup__form")}function a(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(e){e.classList.remove(t.inputErrorClass)})),Array.from(e.querySelectorAll(".popup__input-error")).forEach((function(e){e.textContent="",e.classList.remove(t.errorClass)})),o.disabled=!0,o.classList.add(t.inactiveButtonClass)}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&r(e),t.target.classList.contains("popup__close")&&r(e)}))}));var s,i={baseUrl:"https://nomoreparties.co/v1/wff-cohort-1",headers:{Authorization:"0a1f212b-0a7a-4f94-b33a-45d1e7ad60af","Content-Type":"application/json"}},u=document.querySelector(".places__list"),l=document.querySelector(".profile__edit-button"),d=document.querySelector(".profile__add-button"),p=document.querySelector(".profile__image"),f=document.querySelector(".profile__title"),m=document.querySelector(".profile__description"),_=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_new-card"),h=document.querySelector(".popup_type_image"),v=document.querySelector(".popup_type_avatar"),S=document.querySelector(".popup_type_confirm"),q=h.querySelector(".popup__caption"),g=h.querySelector(".popup__image"),b=c(_),k=b.elements.name,C=b.elements.description,L=c(y),E=L.elements["place-name"],x=L.elements.link,j=c(v),I=j.elements.link,T=c(S),P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function w(e){var t=e.querySelector(".card__like-button");t.addEventListener("click",(function(n){var o,r=e.querySelector(".card__likes-quantity");t.classList.contains("card__like-button_is-active")?(o=e.dataset.imgId,fetch("".concat(i.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка deleteLikeCard: ".concat(e.status," ").concat(e.statusText))}))).then((function(e){r.textContent=e.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка putLikeCard: ".concat(e.status," ").concat(e.statusText))}))}(e.dataset.imgId).then((function(e){r.textContent=e.likes.length})).catch((function(e){console.log(e)})),t.classList.toggle("card__like-button_is-active")}))}function A(e){e.querySelector(".card__delete-button").addEventListener("click",(function(t){T.dataset.imgId=e.dataset.imgId,T.dataset.ownerId=e.dataset.ownerId,S.querySelector(".popup__content").classList.add("popup__content_confirm"),o(S)}))}function U(e,t,n){e.querySelector(".card__image").addEventListener("click",(function(){q.textContent=t,g.src=n,g.alt=t,o(h)}))}function D(e,t){e.querySelector(".button").textContent=t}function B(e){document.querySelector(".profile__image").style.backgroundImage="url(".concat(e,")")}T.addEventListener("submit",(function(e){e.preventDefault();var t,n=u.querySelector("[data-img-id='".concat(e.target.dataset.imgId,"']"));n&&(t=n.dataset.imgId,fetch("".concat(i.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка postNewCard: ".concat(e.status," ").concat(e.statusText))}))).then((function(e){console.log("".concat(e.message,": id - ").concat(n.dataset.imgId))})).catch((function(e){console.log(e)})).finally((function(){n.remove()})),r(S)})),l.addEventListener("click",(function(){b.elements.name.value=f.textContent,b.elements.description.value=m.textContent,a(b,P),o(_)})),b.addEventListener("submit",(function(e){var t,n;e.preventDefault(),D(b,"Сохранение..."),(t=k.value,n=C.value,fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка patchProfileData: ".concat(e.status," ").concat(e.statusText))}))).then((function(e){f.textContent=e.name,m.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){D(b,"Сохранить")})),r(_)})),d.addEventListener("click",(function(){L.reset(),a(L,P),o(y)})),L.addEventListener("submit",(function(e){var n,o;e.preventDefault(),D(L,"Сохранение..."),(n=E.value,o=x.value,fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка postNewCard: ".concat(e.status," ").concat(e.statusText))}))).then((function(e){console.log("new card added: ".concat(e._id)),u.prepend(t(e,A,w,U))})).catch((function(e){console.log(e)})).finally((function(){L.reset(),r(y),D(L,"Сохранить")}))})),p.addEventListener("click",(function(){j.reset(),a(j,P),o(v)})),j.addEventListener("submit",(function(e){var t;e.preventDefault(),D(j,"Сохранение..."),(t=I.value,fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка patchProfileAvatar: ".concat(e.status," ").concat(e.statusText))}))).then((function(e){console.log("avatar updated: ".concat(e.avatar)),B(e.avatar)})).catch((function(e){console.log(e)})).finally((function(){j.reset(),r(v),D(j,"Сохранить")}))})),[_,y,h,v,S].forEach((function(e){e.classList.add("popup_is-animated")})),s=P,Array.from(document.querySelectorAll(s.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){t.classList.remove(n.inputErrorClass);var o=e.querySelector(".".concat(t.id,"-error"));o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,o){t.classList.add(o.inputErrorClass);var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}(n,o,t)}))}))}(e,s)})),fetch("".concat(i.baseUrl,"/users/me"),{method:"GET",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка getProfileData: ".concat(e.status," ").concat(e.statusText))})).then((function(e){var t,n;document.querySelector(".profile__info").dataset.userId=e._id,B(e.avatar),t=e.name,n=e.about,document.querySelector(".profile__title").textContent=t,document.querySelector(".profile__description").textContent=n})).catch((function(e){console.log(e)})).finally((function(){fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка getInitialCards: ".concat(e.status," ").concat(e.statusText))})).then((function(e){e.forEach((function(e){u.append(t(e,A,w,U))}))})).catch((function(e){console.log(e)}))}))})();