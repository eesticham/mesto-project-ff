(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,n,o,r,a){var c=e.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__delete-button"),s=c.querySelector(".card__image"),u=c.querySelector(".card__like-button"),l=c.querySelector(".card__likes-quantity");return c.querySelector(".card__title").textContent=t.name,c.querySelector(".card__image").src=t.link,c.querySelector(".card__image").alt=t.name,a===t.owner._id?i.addEventListener("click",n):i.remove(),u.addEventListener("click",o),s.addEventListener("click",r),c.dataset.imgId=t._id,l.textContent=t.likes.length,t.likes.some((function(e){return e._id===a}))&&u.classList.add("card__like-button_is-active"),c}function n(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}function o(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function a(e){return e.querySelector(".popup__form")}function c(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(e){e.classList.remove(t.inputErrorClass)})),Array.from(e.querySelectorAll(".popup__input-error")).forEach((function(e){e.textContent="",e.classList.remove(t.errorClass)})),o.disabled=!0,o.classList.add(t.inactiveButtonClass)}var i={baseUrl:"https://nomoreparties.co/v1/wff-cohort-1",headers:{Authorization:"0a1f212b-0a7a-4f94-b33a-45d1e7ad60af","Content-Type":"application/json"}};function s(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then(l)}function u(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then(l)}function l(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status," ").concat(e.statusText))}var d,p=document.querySelector(".places__list"),m=document.querySelector(".profile__edit-button"),f=document.querySelector(".profile__add-button"),_=document.querySelector(".profile__image"),v=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),y="",S=document.querySelectorAll(".popup"),g=document.querySelector(".popup_type_edit"),q=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),E=document.querySelector(".popup_type_avatar"),L=document.querySelector(".popup_type_confirm"),C=b.querySelector(".popup__caption"),k=b.querySelector(".popup__image"),x=a(g),A=x.elements.name,T=x.elements.description,U=a(q),I=U.elements["place-name"],w=U.elements.link,B=a(E),D=B.elements.link,P=a(L),N={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function O(e){var t=e.target,n=t.closest(".card"),o=n.querySelector(".card__likes-quantity");(t.classList.contains("card__like-button_is-active")?u:s)(n.dataset.imgId).then((function(e){o.textContent=e.likes.length,t.classList.toggle("card__like-button_is-active")})).catch((function(e){console.log(e)}))}function j(e){var t=e.target.closest(".card");P.dataset.imgId=t.dataset.imgId,o(L)}function J(e){C.textContent=e.target.alt,k.src=k.alt=e.target.src,o(b)}function M(e,t){e.querySelector(".button").textContent=t}function G(e){document.querySelector(".profile__image").style.backgroundImage="url(".concat(e,")")}P.addEventListener("submit",(function(e){e.preventDefault();var t,n=p.querySelector("[data-img-id='".concat(e.target.dataset.imgId,"']"));n&&(t=n.dataset.imgId,fetch("".concat(i.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:i.headers}).then(l)).then((function(e){console.log("".concat(e.message,": id - ").concat(n.dataset.imgId)),n.remove(),r(L)})).catch((function(e){console.log(e)}))})),m.addEventListener("click",(function(){x.elements.name.value=v.textContent,x.elements.description.value=h.textContent,c(x,N),o(g)})),x.addEventListener("submit",(function(e){var t,n;e.preventDefault(),M(x,"Сохранение..."),(t=A.value,n=T.value,fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:t,about:n})}).then(l)).then((function(e){v.textContent=e.name,h.textContent=e.about,r(g),M(x,"Сохранить")})).catch((function(e){console.log(e)}))})),f.addEventListener("click",(function(){U.reset(),c(U,N),o(q)})),U.addEventListener("submit",(function(e){var n,o;e.preventDefault(),M(U,"Сохранение..."),(n=I.value,o=w.value,fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:n,link:o})}).then(l)).then((function(e){console.log("new card added: ".concat(e._id)),p.prepend(t(e,j,O,J,y)),r(q),M(U,"Сохранить")})).catch((function(e){console.log(e)}))})),_.addEventListener("click",(function(){B.reset(),c(B,N),o(E)})),B.addEventListener("submit",(function(e){var t;e.preventDefault(),M(B,"Сохранение..."),(t=D.value,fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then(l)).then((function(e){console.log("avatar updated: ".concat(e.avatar)),G(e.avatar),r(E),M(B,"Сохранить")})).catch((function(e){console.log(e)}))})),S.forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_is-opened")||t.target.classList.contains("popup__close"))&&r(e)}))})),d=N,Array.from(document.querySelectorAll(d.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){t.classList.remove(n.inputErrorClass);var o=e.querySelector(".".concat(t.id,"-error"));o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,o){t.classList.add(o.inputErrorClass);var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}(n,o,t)}))}))}(e,d)})),fetch("".concat(i.baseUrl,"/users/me"),{method:"GET",headers:i.headers}).then(l).then((function(e){var n,o;y=e._id,G(e.avatar),n=e.name,o=e.about,document.querySelector(".profile__title").textContent=n,document.querySelector(".profile__description").textContent=o,fetch("".concat(i.baseUrl,"/cards"),{method:"GET",headers:i.headers}).then(l).then((function(e){e.forEach((function(e){p.append(t(e,j,O,J,y))}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))})();